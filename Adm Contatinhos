#include<stdio.h>
#include<stdlib.h>
#include<string.h>

#define MAX 100

struct Pessoa{
    char* nome;
    char telefone[10];
    
}pessoa[MAX];

void exibirMenu(){
    printf("\n\tSelecione umas das opções a seguir:\n");
    printf("\tI - Inserir novo contato\n"
           "\tP - Pesquisar por um contato\n"
           "\tR - Remover um contato com 'nome'.\n"
           "\tA - Alterar um contato\n"
           "\t0 - Sair\n\n");
}

char* alocarMemoria(int tamanho){
    char* info = NULL;
    info = (char*) malloc(sizeof(tamanho) * sizeof(char));

    if(info == NULL){
        printf("ERRO: impossível alocar a quantidade de memória requisitada!");
        exit(1);
    }
    return info;
}

void cadastrarContato(int registro, char* nomeBuscado){
    char dados[MAX];
    strcpy(dados,nomeBuscado);
    setbuf(stdin, NULL);
    
    //Alocação e cópia de dados
    pessoa[registro].nome = alocarMemoria(strlen(dados));
    strcpy(pessoa[registro].nome, dados);

    //printf("\t\tTelefone: "); //COMENTAR NO RUN.CODES
    scanf("%s", pessoa[registro].telefone);
    setbuf(stdin, NULL);
}

void exibirContato(int indice){
    //printf("\tIndice encontrado: %d\n", indice); //COMENTAR NO RUN.CODES
    printf("\tContatinho encontrado: telefone %s\n", pessoa[indice].telefone);
}

void removerContato(int indice){
    int i;
    //printf("\tIndice encontrado: %d\n", indice); //COMENTAR NO RUN.CODES
    for(i = indice; i < MAX; i++){
        pessoa[i] = pessoa[i+1];
    }
}

int pesquisarContato(int qtdeContatos, char* nomeBuscado){
    int i;
    
    for(i = 0; i < qtdeContatos; i++){
        if(strcmp(nomeBuscado, pessoa[i].nome) == 0)
            return i;
    }
    return -1;
}

void atualizarContato(int indice){
    
    char* nome;
    char fone[16];
    char dados[MAX];
    setbuf(stdin, NULL);
    
    
    //Alocação e cópia de dados
    nome = alocarMemoria(strlen(dados));
    strcpy(nome, dados);
    //printf("\tTelefone: "); //COMENTAR NO RUN.CODES
    scanf("%s", fone);
    setbuf(stdin, NULL);
    strcpy(pessoa[indice].telefone, fone);

}
char leitor(){
    char opcao;
    //printf("\n\tOpção escolhida: "); //COMENTAR NO RUN.CODES
    scanf("%s", &opcao);
    setbuf(stdin, NULL);
    return opcao;
}

int main(){
    char nome[MAX];
    int numeroRegistro = 0;
    char opcaoEscolhida;
    char I, P, R, A;
    int indice;

    do{
        //exibirMenu();
        opcaoEscolhida = leitor();
        
        switch(opcaoEscolhida){
            case 'I': //INSERIR
                //printf("\n\t\tNome: "); //COMENTAR NO RUN.CODES
                scanf("%s", nome);
                indice = pesquisarContato(numeroRegistro, nome);
                
                if(indice >= 0 && indice <= 99)
                    printf("\n\tContatinho ja inserido\n");
                else
                    cadastrarContato(numeroRegistro++, nome);
                break;
                
            case 'P': //PESQUISAR
                //printf("\n\tNome: "); //COMENTAR NO RUN.CODES
                scanf("%s", nome);
                indice = pesquisarContato(numeroRegistro, nome);

                if(indice >= 0 && indice <= 99)
                    exibirContato(indice);
                else
                    printf("\n\tContatinho nao encontrado\n");
                break;
            
            case 'R': //REMOVER
                //printf("\n\tNome: "); //COMENTAR NO RUN.CODES
                scanf("%s", nome);
                indice = pesquisarContato(numeroRegistro--, nome);
                
                if(indice >= 0 && indice <= 99)
                    removerContato(indice);
                else
                    printf("\n\tOperacao invalida: contatinho nao encontrado\n");
                break;
               
            case 'A': //ALTERAR
                //printf("\n\tNome: "); //COMENTAR NO RUN.CODES
                scanf("%s", nome);
                indice = pesquisarContato(numeroRegistro, nome);
                
                if(indice >= 0 && indice <= 99)
                    atualizarContato(indice);
                else
                    printf("\n\tOperacao invalida: contatinho nao encontrado\n");
                break;
                
            case '0': //SAIR
                //printf("\n\tSaindo..."); //COMENTAR NO RUN.CODES
                break;
            default:
                //printf("Opção inválida!\n"); //COMENTAR NO RUN.CODES
                //exibirMenu();
                opcaoEscolhida = leitor();
        }

    }while(opcaoEscolhida != '0');
}

